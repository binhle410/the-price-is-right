<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css"/>

    <!-- Optional theme -->
    <link rel="stylesheet" href="css/bootstrap-theme.min.css"/>

    <!-- Latest compiled and minified JavaScript -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script src="js/jquery-ui.js"></script>

    <script src="js/jquery.formatter.min.js"></script>

    <script src="js/currencyFormatter.min.js"></script>

    <!-- http://www.jqueryscript.net/animation/jQuery-Plugin-To-Create-Canvas-Based-Fireworks.html -->
    <script src="js/jquery.fireworks.js"></script>

</head>
<body style="background-color: #c7ddef">
<!-- Fixed navbar -->
<nav class="navbar navbar-inverse">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--<a class="navbar-brand" href="#">Sản phẩm</a>-->
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul id="menu_products" class="nav navbar-nav">
                <li><a href="index.html">HOME</a></li>
                <!--<li class="dropdown">-->
                <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"-->
                <!--aria-expanded="false">Dropdown <span class="caret"></span></a>-->
                <!--<ul class="dropdown-menu">-->
                <!--<li class="active"><a href="#">Action</a></li>-->
                <!--<li><a href="#">Another action</a></li>-->
                <!--<li><a href="#">Something else here</a></li>-->
                <!--<li role="separator" class="divider"></li>-->
                <!--<li class="dropdown-header">Nav header</li>-->
                <!--<li><a href="#">Separated link</a></li>-->
                <!--<li><a href="#">One more separated link</a></li>-->
                <!--</ul>-->
                <!--</li>-->
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>


<div id="divContainer" class="container theme-showcase" role="main">
    <div class="row">
        <div class="col-xs-12 text-center">
            <div class="hidden">
                <audio id="audioPlayer"></audio>
            </div>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Lượt chơi</th>
                    <th>Chiên Con</th>
                    <th>Ấu Nhi</th>
                    <th>Thiếu Nhi</th>
                    <th>Nghĩa Sĩ</th>
                    <th>Tông Đồ</th>
                    <td></td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th>Lượt 1</th>
                    <td><input id="11" class="ipt form-control"/></td>
                    <td><input id="12" class="ipt form-control"/></td>
                    <td><input id="13" class="ipt form-control"/></td>
                    <td><input id="14" class="ipt form-control"/></td>
                    <td><input id="15" class="ipt form-control"/></td>
                    <td>
                        <button id="1" data-mode="edit" class="save btn btn-default btn-sm">Lưu thông tin</button>
                    </td>
                </tr>
                <tr>
                    <th>Lượt 2</th>
                    <td><input id="21" class="ipt form-control"/></td>
                    <td><input id="22" class="ipt form-control"/></td>
                    <td><input id="23" class="ipt form-control"/></td>
                    <td><input id="24" class="ipt form-control"/></td>
                    <td><input id="25" class="ipt form-control"/></td>
                    <td>
                        <button id="2" data-mode="edit" class="save btn btn-default btn-sm">Lưu thông tin</button>
                    </td>
                </tr>
                <tr>
                    <th>Lượt 3</th>
                    <td><input id="31" class="ipt form-control"/></td>
                    <td><input id="32" class="ipt form-control"/></td>
                    <td><input id="33" class="ipt form-control"/></td>
                    <td><input id="34" class="ipt form-control"/></td>
                    <td><input id="35" class="ipt form-control"/></td>
                    <td>
                        <button id="3" data-mode="edit" class="save btn btn-default btn-sm">Lưu thông tin</button>
                    </td>
                </tr>
                <tr>
                    <th>Lượt 4</th>
                    <td><input id="41" class="ipt form-control"/></td>
                    <td><input id="42" class="ipt form-control"/></td>
                    <td><input id="43" class="ipt form-control"/></td>
                    <td><input id="44" class="ipt form-control"/></td>
                    <td><input id="45" class="ipt form-control"/></td>
                    <td>
                        <button id="4" data-mode="edit" class="save btn btn-default btn-sm">Lưu thông tin</button>
                    </td>
                </tr>
                <tr>
                    <th>Lượt 5</th>
                    <td><input id="51" class="ipt form-control"/></td>
                    <td><input id="52" class="ipt form-control"/></td>
                    <td><input id="53" class="ipt form-control"/></td>
                    <td><input id="54" class="ipt form-control"/></td>
                    <td><input id="55" class="ipt form-control"/></td>
                    <td>
                        <button id="5" data-mode="edit" class="save btn btn-default btn-sm">Lưu thông tin</button>
                    </td>
                </tr>
                <tr>
                    <th>Kết quả</th>
                    <td>
                        <div id="r1"></div>
                    </td>
                    <td>
                        <div id="r2"></div>
                    </td>
                    <td>
                        <div id="r3"></div>
                    </td>
                    <td>
                        <div id="r4"></div>
                    </td>
                    <td>
                        <div id="r5"></div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>


</div> <!-- /container -->

<script>

    (function ($) {
        var products = []

        var activeProduct = null;

        var $player = $('#audioPlayer');

        var audioElement = document.createElement('audio');

        $.each(products, function (i, _prod) {
            if (_prod.active == true) {
                activeClass = ' active '
                activeProduct = _prod;
                $('#product_image').attr('src', 'img/' + _prod.src);
            } else {
                activeClass = ''
            }
            if (_prod.hasChildren == false) {
                _itemClass = 'menu-item';
                _html = '<li id="menu_item_' + _prod.id + '"' + ' class = "menu-item ' + activeClass + '" ' + '><a href="#" id="product_' + _prod.id + '">' + _prod.name + '</a></li>';
            } else {
                _itemClass = 'dropdown menu-item';
                _html = '<li id="menu_item_' + _prod.id + '"' + ' class = "dropdown ' + activeClass + '" ' + '><a aria-expanded="false" role="button" aria-haspopup="true" data-toggle="dropdown" class="dropdown-toggle" href="#" id="product_' + _prod.id + '">' + _prod.name + '<span class="caret"></span></a>';
                _html += '<ul class="dropdown-menu" id="sub_menu_item_' + _prod.id + '">  ' + ' </ul> </li>';
            }
            console.log(_html);
            if (_prod.parent == null) {
                $('#menu_products').append(_html);
            } else {
                $('#sub_menu_item_' + _prod.parent).append(_html);
            }
            if (_prod.hasChildren == false) {
                $('#product_' + _prod.id).on('click', function () {

                    localStorage.setItem('guesser', JSON.stringify(new Array()));
                    $guessList.empty();

                    $.each(products, function (i, __prod) {
                        if (__prod.id == _prod.id) {
                            activeProduct = __prod;
                            $('#product_image').attr('src', 'img/' + __prod.src);
                            $('.menu-item').removeClass('active');
                            $('#menu_item_' + _prod.id).addClass(' active');
                            //                        $('#menu_item_' + _prod.id).attr('class', _itemClass + ' active');
                        }
                    });
                });
            }
        })

        var currencyFormatterParams =
            {
                currency: 'VND', 			// If currency is not supplied, defaults to USD
                symbol: 'k',			// Overrides the currency's default symbol
                locale: 'vi',			// Overrides the currency's default locale (see supported locales)
                decimal: ',',			// Overrides the locale's decimal character
                group: '.',			// Overrides the locale's group character (thousand separator)
                pattern: '#,###.'		// Overrides the locale's default display pattern

                // The pattern follows standard unicode currency pattern notation.
                // comma = group separator, dot = decimal separator, exclamation = currency symbol
            }

        var currencyFormatter = OSREC.CurrencyFormatter.getFormatter(currencyFormatterParams);

        formatMoney = function () {
            OSREC.CurrencyFormatter.formatAll(
                {
                    selector: '.money',

                });
        }
        var winner = null;
        findWinner = function (guesser) {
            _winner = null;
            _wonPrice = 0;
            $.each(guesser, function (i, _guess) {
                if (_guess.price <= activeProduct.price) {
                    if (_guess.price > _wonPrice) {
                        _wonPrice = _guess.price;
                        _winner = _guess;
                    }
                }
            })
            if (_wonPrice == 0) {
                return null;
                $.each(guesser, function (i, _guess) {
                    if (_guess.price > activeProduct.price) {
                        if (_wonPrice == 0) {
                            _wonPrice = _guess.price;
                            _winner = _guess;
                        }
                        if (_guess.price < _wonPrice) {
                            _wonPrice = _guess.price;
                            _winner = _guess;
                        }
                    }
                })
            }
            return _winner;
        }

//        $('#price').formatter({
//            'pattern': '{{999}},{{999}}',
//        });

        function dump(obj) {
            var out = '';
            for (var i in obj) {
                out += i + ": " + obj[i] + "\n";
            }

            alert(out);

            // or, if you wanted to avoid alerts...

            var pre = document.createElement('pre');
            pre.innerHTML = out;
            document.body.appendChild(pre)
        }

        appendGuess = function ($guessList, guess) {
            _html = '<tr id="' + guess.id + '"><td><h1 style="font-weight: bolder;">' + guess.name + ' - <span>' + currencyFormatter(guess.price) + '</span> ';
            _html += ' <button data-id="' + guess.id + '" id="button_' + guess.id + '"  type="button" class="btn btn-default" aria-label="Left Align"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>';
            _html += '</h1>';
            _html += '</td></tr>';
            $guessList.prepend(_html);
            $('#button_' + guess.id).on('click', function () {
                $('#' + guess.id).hide();
                var guesser = JSON.parse(localStorage.getItem('guesser'));
                $.each(guesser, function (i, _guess) {
//                    console.log(i);
//                    console.log(guess);
                    if (guess.id == _guess.id) {
                        guesser.splice(i, 1);
                        localStorage.setItem('guesser', JSON.stringify(guesser));
                    }
                })

            });
        }


        /* ----------------------------------------------- */
        /* ----------------------------------------------- */
//        https://osrec.github.io/currencyFormatter.js/
        /* OnLoad Page */
        $(document).ready(function ($) {

            for (_i = 1; _i < 6; _i++) {
                teamId = 'team' + _i;
                localStorage.setItem(teamId, 0);
            }

            $('.ipt').change(function (e) {
                $val = $(this).val();
                $(this).val($val.toUpperCase());

            });

            $('.ipt').keypress(function (e) {
                if (e.which == 13) {
//                    formatMoney();
                }
                $id = parseInt($(this).attr('id'));
                $nextId = $id + 1;

                $nextIpt = $('#' + $nextId);

                if ($nextIpt.length > 0) {
                    $nextIpt.focus();
                } else {
                    $row = Math.floor($nextId / 10);
                }
//                $(this).next('.ipt').focus();
            });

            if (typeof(Storage) !== "undefined") {
                var guesser = JSON.parse(localStorage.getItem('guesser'));
                console.log(guesser);
                $guessList = $('#guess-list');
                if ($.isArray(guesser)) {

                } else {
                }
                $.each(guesser, function (i, guess) {
                    appendGuess($guessList, guess);
                })

            } else {
                // Sorry! No Web Storage support..
            }

            $('#myModal').on('hidden.bs.modal', function (e) {
                $('.modal-header').fireworks('destroy');
                $('body').fireworks('destroy');
            })

            $('.save').click(function (e) {
                $row = $(this).attr('id');
                $yCount = 0;
                $rCount = 0;
                for (var i = 1; i < 6; i++) {
                    $rowId = $row + '' + i;
                    $val = $('#' + $rowId).val().toUpperCase();
                    if ($val === 'Y') {
                        $yCount++;
                    } else {
                        $rCount++;
                    }
                }
                $winningSide = '';
                if ($rCount > $yCount) {
                    $winningSide = 'R';
                } else {
                    $winningSide = 'Y';
                }

                if ($(this).data('mode') === 'edit') {
                    for (var i = 1; i < 6; i++) {
                        $rowId = $row + '' + i;
                        $val = $('#' + $rowId).val().toUpperCase();
                        console.log($('#' + $rowId));
                        $('#' + $rowId).prop('disabled', 'disabled');
                        if ($val === $winningSide) {
                            $teamScore = parseInt(localStorage.getItem('team' + i));
                            localStorage.setItem('team' + i, ++$teamScore);
                            $('#r' + i).text(localStorage.getItem('team' + i));
                        }
                    }
                    $(this).data('mode', 'show');
                    $(this).text('Sửa thông tin');
                } else {
                    for (var i = 1; i < 6; i++) {
                        $rowId = $row + '' + i;
                        $val = $('#' + $rowId).val().toUpperCase();
                        console.log($('#' + $rowId));
                        $('#' + $rowId).removeProp('disabled');
                        if ($val === $winningSide) {
                            $teamScore = parseInt(localStorage.getItem('team' + i));
                            localStorage.setItem('team' + i, --$teamScore);
                            $('#r' + i).text(localStorage.getItem('team' + i));
                        }
                    }
                    $(this).data('mode', 'edit');
                    $(this).text('Lưu thông tin');
                }

//                alert(winner.name + '  ' + winner.price);
                if (winner == null) {
//                    _noWinnerHTML = '';
//                    _noWinnerHTML += '<h1><strong>THẬT ĐÁNG TIẾC</strong>. CẢ NHÀ MÌNH ĐI CHỢ HƠI QUÁ TAY RỒI !!! </h1>';
//                    _noWinnerHTML += '';
//                    $('#modal_body').html(_noWinnerHTML);
//                    audioElement.setAttribute('src', 'mp3/fail' + Math.floor((Math.random() * 10) + 1) + '.mp3');
//                    audioElement.play();
                } else {

                }
//                $('#myModal').modal('show');

            })

            $('#btn-clear').click(function (e) {
                localStorage.setItem('guesser', JSON.stringify(new Array()));
                $guessList.empty();
            })

            $('#name').keypress(function (e) {
                if (e.which == 13) {

                }
            });


        });
        /* OnLoad Window */
        var init = function () {

        };
        window.onload = init;

    })(jQuery);

</script>

<div id="myModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>-->
                <!--</button>-->
                <!--<h1 class="modal-title">KẾT QUẢ !</h1>-->
            </div>
            <div class="modal-body" id="modal_body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script>

</script>
</body>
</html>